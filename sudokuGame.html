<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="sudokuGame.css">
    <title>Mini Sudoku Game</title>
</head>

<body class="kropp">
    <div id="app"></div>
        <script>
            let boards = [];
            let selectedBoardIndex = 0;
            function initiateBoard() {
                // model (inneholder datastrukturen og logikken for brettet)
                boards = [
                    '12  34          ', // delvis utfylt, ingen feil
                    '121 34          ', // delvis utfylt, samme tall to ganger på en rad
                    '12  34  1       ', // delvis utfylt, samme tall to ganger på en kolonne
                    '12  34    2    2', // delvis utfylt, samme tall to ganger i en firkant            
                    '1234341221434321', // helt utfylt, ingen feil
                    '1434321221434321', // helt utfylt, samme tall to ganger på en rad
                    '1432341221434321', // helt utfylt, samme tall to ganger på en kolonne
                ];

            }

            initiateBoard();

            // view (viser sudoku-brettet og lar brukeren interagere med det)
            updateView();
            function updateView() {
                document.getElementById('app').innerHTML = /*HTML*/`
                <div class="board">
                    ${createSquares()}
                </div>
             <!--   <select onchange="selectBoard(this.value)">     //drop-downmenyen som var der i utgangspunktet, men som jeg tok vekk for sluttresultatets del i selve spillet
                    ${createOptions()}
                    updateView();
                </select>-->
                
                <div id="buttons">
                <button id="rightWrong" onclick="checkRightOrWrong()">SJEKK RIKTIG ELLER FEIL</button>
                <button id="restart" onclick="restart()">RESTART</button>
                </div>
            `;
            }

            function restart() {
                updateView();
                boards[selectedBoardIndex] = boards[selectedBoardIndex].replace(/[1-4]/g, ' '); // Replace all numbers with empty spaces
                initiateBoard(); //kaller på brettet på nytt --> initiate
            }


            function checkSudoku(board) {
                // Check rows
                for (let i = 0; i < 4; i++) {
                    const row = board[i];
                    if (!isUnique(row)) {
                        return false; // If any row has duplicates, return false
                    }
                }

                // Check columns
                for (let i = 0; i < 4; i++) {
                    const column = [];
                    for (let j = 0; j < 4; j++) {
                        column.push(board[j][i]);
                    }
                    if (!isUnique(column)) {
                        return false; // If any column has duplicates, return false
                    }
                }

                // Check 2x2 boxes
                for (let i = 0; i < 4; i += 2) {
                    for (let j = 0; j < 4; j += 2) {
                        const box = [];
                        for (let k = i; k < i + 2; k++) {
                            for (let l = j; l < j + 2; l++) {
                                box.push(board[k][l]);
                            }
                        }
                        if (!isUnique(box)) {
                            return false; // If any 2x2 box has duplicates, return false
                        }
                    }
                }

                return true; // If all checks pass, return true
            }

            function isUnique(arr) {
                const seen = {};
                for (let i = 0; i < arr.length; i++) {
                    if (!isNaN(arr[i]) && seen[arr[i]]) {
                        // console.log / arr[i]
                        return false; // If a value is seen again, it's not unique
                    }
                    seen[arr[i]] = true;
                }
                return true; // All values are unique
            }


            function checkRightOrWrong() {
                const board = []; // Array to hold the values of the Sudoku board
                const nodeList = document.querySelectorAll('.square');


                const sudokuBoard = Array.from(nodeList).map(element => element.value);  //henter ut informasjonen fra brettet
                console.log(sudokuBoard); // Using Array.from()

                board[0] = 1
                board[1] = 2
                board[4] = 3
                board[5] = 4

                for (let number of sudokuBoard) {
                    
                    if (typeof parseInt(number) === 'number') board.push(parseInt(number.trim(), 10) || " "); // Using parseInt() to convert string to number
                    // Or:
                    // board.push(+value); // Using unary plus operator to convert string to number
                }

                console.log('Board:', board); // Log the board array to the console (for debugging)

                const board2 = [];
                for (let i = 0; i < board.length; i += 4) {
                    board2.push(board.slice(i, i + 4));
                }

                if (checkSudoku(board2)) {
                    alert('Congratulations! You solved the Sudoku puzzle.');
                    const board2=document.getElementById('boards2');
                    boards.style.color='green';
                } else {
                    const boards2=document.getElementById('boards2');
                    boards2.style.color='red';
                    alert('Sorry, the Sudoku solution is incorrect.');
                }
            }


            function createOptions() {
                let html = '';
                for (let index = 0; index < boards.length; index++) {
                    const board = boards[index];
                    html += /*HTML*/`<option value="${index}">${board}</option>`;
                }


                return html;
            }

            function createSquares() { //har endret funksjonen slik at den viser tomme felter som tekst(nummer)inndata i stedet for enkle div'er, slik at brukeren kan fylle inn tallene selv. Har gitt input-feltene klassen "square" for stylingformål.
                const board = boards[selectedBoardIndex];

                // console.log("createSquares" + board);
                
                let html = '';
                for (let square of board) {
                    if (square === ' ') {
                        html += '<input type="number" maxlength="1" class="square" oninput="validateInput(this)">';
                    } else {
                        html += /*HTML*/`<div class="square">${square}</div>`;
                    }

                }
                return html;
            }



            // controller (håndterer brukerens interaksjon og oppdaterer model og view)
            function selectBoard(index) {
                selectedBoardIndex = index;
                updateView();
            }

            function validateInput(input) {
                const value = input.value;
                if (value !== ' ' && !/^[1234]$/.test(value)) {
                    input.value = ' ';
                }

            }



        </script>
    
</body>

</html>